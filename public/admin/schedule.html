<!DOCTYPE html>
<html lang="en">
    <head>
      <title>Production Plan</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="/css/gantt.css" type="text/css"/>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
       <!-- Include the image-diff library -->
      <script src="/js/quagga.min.js"></script>
       <!-- Or use a CDN -->
      <!-- <script src="https://cdn.rawgit.com/serratus/quaggaJS/0420d5e0/dist/quagga.min.js"></script> -->
      <!--  jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Isolated Version of Bootstrap, not needed if your site already uses Bootstrap -->
<link rel="stylesheet" href="https://formden.com/static/cdn/bootstrap-iso.css" />

<!-- Bootstrap Date-Picker Plugin -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
    </head>
    <body>


      <nav class="navbar navbar-default">
       
        <div class="container-fluid">
          
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
           
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            
              <span class="sr-only">Toggle navigation   </span>
             
              <span class="icon-bar"> </span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              
            </button>
           
            <a class="navbar-brand" href="#">ampec system</a>
            
          </div>
      
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
              <li><a href="#">Link</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Manual<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/admin/schedule.html">Production Plan Input</a></li>
                  <li><a href="/admin/production.html">Production Data Update</a></li>
                  <li><a href="/admin/hour.html">Working Hour Input</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="/admin/dashboard.html">Dashboard</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="/nav.html">Back to Main</a></li>
                </ul>
              </li>
            </ul>
            <form class="navbar-form navbar-left">
              <div class="form-group">
                <input type="text" class="form-control" placeholder="Search">
              </div>
              <button type="submit" class="btn btn-default">Submit</button>
            </form>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="#">Link</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="#">Separated link</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
       
      <!-- Extended default form grid -->

    <div class="form-group col-md-3">  
    <form>
      <!-- Grid row -->
      <div class="form-row">
        <!-- Default input -->
        <div id="scanner-container"></div>
        <div class="form-group col-md-6">
          <label>Production Order #</label>
          <input type="text" class="form-control" id="MyInput">
        </div>
        <!-- Default input -->
        <div class="form-group col-md-6">
          <label>Material #</label>
          <input type="text" class="form-control" id="materialNum">
        </div>
      </div>

      
      <!-- Grid row -->
      <div class="form-row">
        <!-- Default input -->
        <div class="form-group col-md-6">
          <label>Process Name</label>
          <input type="text" class="form-control" id="recordProcess">
        </div>
        <!-- Default input -->
        <div class="form-group col-md-6">
          <label>Planned Output</label>
          <input type="text" class="form-control" id="outputQty">
        </div>
      </div>
      
      <!-- Grid row -->
      <div class="form-row">
        <!-- Default input -->
        <div class="bootstrap-iso">
        <div class="form-group col-md-6">
          <label class="control-label" for="date">Start Date</label>
          <input class="form-control" id="start" name="date" placeholder="MM/DD/YYY" type="text"/>
        </div>
        <!-- Default input -->
        
        <div class="form-group col-md-6">
          <label class="control-label" for="date">End Date</label>
          <input class="form-control" id="end" name="date" placeholder="MM/DD/YYY" type="text"/>
        </div>
        </div>
        <div class="form-group col-md-12">
        <button class="btn btn-primary btn-md" type="submit" onclick="fetchData();">Query</button> 
        <input type="button" class="btn btn-primary btn-md" id="btn" value="Start/Stop the scanner"></button> 
        <button class="btn btn-primary btn-md" type="submit" onclick="createProductionOrder();">Create</button>
         
        </div>
      </div>
      </div>
           </div>
         </div>    
        </div>
       </div>
      </form>
      </div>
    
      <div class="form-group col-md-9">
        <button class="btn btn-primary btn-md" type="submit" onclick="fetchGanttChart();">Gantt chart</button> 
        <label for="output" style="font-size: 25px">Today's production plan:</label> 
        <div id="chart"></div>  
      </div>

          
      <!-- Grid row -->
      <div class="form-row">
        <div class="form-group col-md-9">
          
        </div>
        <div class="form-group col-md-3">
          
        </div>
      </div>
 
    <!-- Extended default form grid -->
   
        <!-- <div class="container-fluid">
            
            
            <div class="row">
              <div class="col-sm-2" style="background-color:lightgrey;">
               
                
                
              </div>
              <div class="col-sm-10" style="background-color:lightgray;">
                <br>
                
                
                
                
               
                      
                <form action="">

                    <div class="form-group">
                      <label for="output" style="font-size: 25px">Production Order #:</label>
                      <input type="text" class="form-control" style="font-size: 25px;" id="MyInput" name="output">
                    </div>

                    <div class="form-group">
                      <label for="output" style="font-size: 25px">Material #:</label>
                      <input type="text" class="form-control" style="font-size: 25px;" id="materialNum" name="materialNum">
                    </div>

                    <div class="form-group">
                      <label for="output" style="font-size: 25px">Production Group:</label>
                      <input type="text" class="form-control" style="font-size: 25px;" id="productionGroup" name="productionGroup">
                    </div>

                    <div class="form-group">
                      <label for="process" style="font-size: 25px">Process name:</label>
                      <input type="text" class="form-control" style="font-size: 25px;" id="recordProcess" name="process">
                    </div>

                    <div class="form-group">
                        <label for="process" style="font-size: 25px">Start:</label>
                        <input type="text" class="form-control" style="font-size: 25px;" id="start" name="start">
                    </div>

                    <div class="form-group">
                        <label for="process" style="font-size: 25px">End:</label>
                        <input type="text" class="form-control" style="font-size: 25px;" id="end" name="end">
                    </div>

                    <div class="form-group">
                        <label for="output" style="font-size: 25px">Output Qty:</label>
                        <input type="text" class="form-control" style="font-size: 25px;" id="outputQty" name="outputQty"><br>
                    </div>

                </form>

                    
                    </div>
                    
                    </div>
                  
                  
              </div>
                
            </div>
          </div> -->
          <div id="chart"></div>
        <script src="/js/camera.js"></script>
        
        <script src="/js/gantt.js"></script>
        <!-- <script src="/js/initialize-gantt.js"></script> -->

        <script>
          //Date picker function
          $(document).ready(function(){
            var date_input=$('input[name="date"]'); //our date input has the name "date"
            var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
            var options={
              format: 'mm/dd/yyyy',
              container: container,
              todayHighlight: true,
              autoclose: true,
            };
            date_input.datepicker(options);
          })
         
          // fetch production order infomation from DB
          function fetchData (code){

            var productionOrderNum =  code;
            // var recordProcess = document.getElementById('recordProcess').value;
            // var outputQty = document.getElementById('outputQty').value;
            // let today = new Date().toISOString().slice(0, 10);
            let options = {
                headers: {
                    "Content-Type": "application/json"
                     },
                method: "POST", 
                body: JSON.stringify({
                    productionOrderNum:  productionOrderNum,
                    // recordProcess: recordProcess,
                    // outputQty:  outputQty,
                    // date: today
                    })
                
               };
            
            fetch('/api/1.0/admin/productionOrderInfo', options)
                .then(response => {
                    let message = response.json();
                    console.log('fetching...');
                    return message;
                    })
                .then(result => {
                    if (result) {
                        let record_process = result[0].record_process;
                        let material_num = result[0].material_num;
                        let outputQty = result[0].output;
                        let start = new Date(result[0].start);
                        let end = new Date(result[0].end);
                        
                        console.log('API fetch success...')
                        document.getElementById('recordProcess').value = record_process;
                        document.getElementById('materialNum').value = material_num;
                        document.getElementById('outputQty').value = outputQty;
                        document.getElementById('start').value = start.toLocaleDateString() + ' ' + start.toLocaleTimeString();
                        document.getElementById('end').value = end.toLocaleDateString() + ' ' + end.toLocaleTimeString();
                        } else {
                          alert(result.msg);
                          }
                   });
            }
            
            // fetch production order infomation from DB to make gantt chart
            function fetchGanttChart() {
              let data = [];
                let today = new Date().toISOString().slice(0, 10);
                let options = {
                    headers: {
                        "Content-Type": "application/json"
                        },
                    method: "POST", 
                    body: JSON.stringify({
                        date: today
                        })
                    
                  };
                  
                fetch('/api/1.0/admin/ganttchart', options)
                    .then(response => {
                        let message = response.json();
                        console.log('test');
                        return message;
                        })
                    .then(result => {
                        if (result) {
                            
                            console.log("API fetch success...");

                            //create gantt chart data
                            let ganttdata = {}
                            for (let i=0; i<result.length; i+=1){
                                ganttdata = {
                                recordID: i+1,
                                row: `${result[i].production_order_num}`,
                                tooltip: `${result[i].material_num}, ${result[i].record_process}, ${result[i].start}, ${result[i].end}`,
                                start: `${result[i].start}`,
                                end: `${result[i].end}`,
                              }
                                data.push(ganttdata);
                            }
                            //An API call to grab data
                            function refreshFunction() {
                                
                                return data;
                                }
                          
                                //Parameters that the chart expects
                                let params = {
                                sidebarHeader: "Unused right now",
                                noDataFoundMessage: "No data found",
                                startTimeAlias: "start",
                                endTimeAlias: "end",
                                idAlias: "recordID",
                                rowAlias: "row",
                                linkAlias: null,
                                tooltipAlias: "tooltip",
                                // groupBy: "groupId,subGroupId",
                                // groupByAlias: "group,subGroup",
                                refreshFunction: refreshFunction
                                }
                          
                                //Create the chart.
                                //On first render the chart will call its refreshData function on its own.
                                let ganttChart = new Gantt("chart", params);
                          
                                //To refresh the chart's data
                                ganttChart.refreshData();
                                                
                              } else {
                                alert(result.msg);
                                }
                          });
                }

                function createProductionOrder() {

                  let data = [];

                  let productionOrderNum =  document.getElementById('MyInput');
                  let materialNum = document.getElementById('materialNum');
                  // let productionGroup = document.getElementById('productionGroup');
                  let recordProcess = document.getElementById('recordProcess');
                  let start = document.getElementById('start');
                  let end = document.getElementById('end');
                  let outputQty = document.getElementById('outputQty');

                  let options = {
                      headers: {
                          "Content-Type": "application/json"
                          },
                      method: "POST", 
                      body: JSON.stringify({
                          productionOrderNum: productionOrderNum,
                          materialNum: materialNum,
                          // productionGroup: productionGroup,
                          recordProcess: recordProcess,
                          start: start,
                          end: end,
                          outputQty: outputQty,
                          })
                      
                    };
                    productionOrderNum.value = '';
                    materialNum.value = '';
                    // productionGroup.value = '';
                    recordProcess.value = '';
                    start.value = '';
                    end.value = '';
                    outputQty.value = '';

                  fetch('/api/1.0/admin/createProductionOrder', options)
                      .then(response => {
                          let message = response.json();
                          console.log('test');
                          return message;
                          })
                      .then(result => {
                          if (result) {
                              
                              console.log("API fetch success...");
                                } else {
                                  alert(result.msg);
                                  }
                            });

                }
        
</script>

    </body>
</html>