<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <link rel="canonical" href="https://getbootstrap.com/docs/3.3/examples/dashboard/">

    <title>Dashboard Template for Bootstrap</title>

 

    <!-- Custom styles for this template -->
    <!-- <link href="/dashboard.css" rel="stylesheet"> -->

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->
    
    <link rel="stylesheet" href="/css/gantt.css" type="text/css"/>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
       <!-- Include the image-diff library -->
      <!-- <script src="/js/quagga.min.js"></script> -->
       <!-- Or use a CDN -->
      <!-- <script src="https://cdn.rawgit.com/serratus/quaggaJS/0420d5e0/dist/quagga.min.js"></script> -->
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
      <!-- Bootstrap Date-Picker Plugin -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
      
   <!-- Highcharts -->
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/data.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script> 
  <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>

  <!--Sweet Alert2 CDN-->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  </head>

  <body>

    <!--Nav bar-->
    <nav class="navbar navbar-default">
       
      <div class="container-fluid">
        
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
         
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          
            <span class="sr-only">Toggle navigation   </span>
           
            <span class="icon-bar"> </span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            
          </button>
          <a href="/index.html"><img src="/logo/logo_calculabor.png" width="50px" height="50px"></a>
          <!-- <a class="navbar-brand" href="/nav.html"></a> -->
          
        </div>
    
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          
          <ul class="nav navbar-nav">
            <!-- <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
            <li><a href="#">Link</a></li> -->
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Manual<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/admin/schedule.html">Production Plan Input</a></li>
                <li><a href="/admin/production.html">Production Data Update</a></li>
                <li><a href="/admin/hour.html">Working Hour Input</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/admin/dashboard.html">Dashboard</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/index.html">Navigator</a></li>
              </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-left">
            <!-- <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div> -->
            <button type="submit" class="btn btn-default">Submit</button>
            
          </form>
          
         
          
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Link</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Separated link</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
      
    </nav>

    <!--Select dashboard show period--> 
    
      
        
      <!-- Default input -->
      <div class="form-group col-md-4">
        <label for="output">Process</label>
        <select class="form-control" id="recordProcess">
          <option ></option>
          <option >process_1</option>
          <option >process_2</option>
          <option >process_3</option>
          <option >process_4</option>
          <option >process_5</option>
          <option >process_6</option>
          <option >process_7</option>
          <option >process_8</option>
          <option >process_9</option>
          <option >process_10</option>
        </select>
      </div> 

      <div class="bootstrap-iso">

      <div class="form-group col-md-4">
        <label class="control-label" for="date">Start Date</label>
        <input class="form-control" id="startDate" name="date" placeholder="MM/DD/YYY" type="text"/>
      </div>
    <!-- Default input -->
    
      <div class="form-group col-md-4">
        <label class="control-label" for="date">End Date</label>
        <input class="form-control" id="endDate" name="date" placeholder="MM/DD/YYY" type="text"/>
      </div>
    </div>

  </div>
  <div class="form-group col-md-12">
    <button class="btn btn-primary btn-md" type="submit" onclick="dashboard1();">Show Process Eff. by Date<img src="/logo/kanban.svg" alt="" width="25" height="20" title="Bootstrap"></button> 
  </div>
</div>
<div class="bootstrap-iso">

  <div class="form-group col-md-4">
    <label class="control-label" for="date">Select Date</label>
    <input class="form-control" id="startDate2" name="date" placeholder="MM/DD/YYY" type="text"/>
  </div>
  <div class="form-group col-md-12">
    <button class="btn btn-primary btn-md" type="submit" onclick="dashboard2();">Show Daily Eff. by Process<img src="/logo/kanban.svg" alt="" width="25" height="20" title="Bootstrap"></button> 
  </div>
  <!--Dashboard -->
    <div class="container-fluid">
      <div class="row">
        
        <div class="col-sm-12 col-sm-offset-1 col-md-12 col-md-offset-0 main">
          <h1 class="page-header">Dashboard</h1>

          <div class="row placeholders">
            <div class="col-xs-6 col-sm-6 placeholder">
              <h4>Efficiency / Date</h4>
              <span class="text-muted">PPH/Day</span>
              <div id="myDiv1"></div>   
              <div id="myDiv1.1"></div>
              <!-- <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="400" height="400" class="img-responsive" alt="Generic placeholder thumbnail"> -->
              
            </div>
            <div class="col-xs-6 col-sm-6 placeholder">
              <h4>Efficiency / Process</h4>
              <span class="text-muted">(PPH/Process)</span>
              <div id="myDiv2"></div> 
              <div id="plot2"></div> 
               
              <!-- <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="400" height="400" class="img-responsive" alt="Generic placeholder thumbnail"> -->
              
            </div>
            <!-- <div class="col-xs-6 col-sm-3 placeholder"> -->
              <!-- <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="400" height="400" class="img-responsive" alt="Generic placeholder thumbnail"> -->
              <!-- <h4>Act. WH v.s. Target WH</h4>
              <span class="text-muted">(Actual hours v.s. Target hours)</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder"> -->
              <!-- <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="400" height="400" class="img-responsive" alt="Generic placeholder thumbnail"> -->
              <!-- <h4>Act. Output v.s. Target Output</h4>
              <span class="text-muted">(Actual pcs v.s. Target pcs)</span>
            </div> -->
          </div>

          <!-- <h2 class="sub-header">Section title</h2>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                  <th>Header</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1,001</td>
                  <td>Lorem</td>
                  <td>ipsum</td>
                  <td>dolor</td>
                  <td>sit</td>
                </tr>
                <tr>
                  <td>1,002</td>
                  <td>amet</td>
                  <td>consectetur</td>
                  <td>adipiscing</td>
                  <td>elit</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>Integer</td>
                  <td>nec</td>
                  <td>odio</td>
                  <td>Praesent</td>
                </tr>
                <tr>
                  <td>1,003</td>
                  <td>libero</td>
                  <td>Sed</td>
                  <td>cursus</td>
                  <td>ante</td>
                </tr>
                <tr>
                  <td>1,004</td>
                  <td>dapibus</td>
                  <td>diam</td>
                  <td>Sed</td>
                  <td>nisi</td>
                </tr>
                <tr>
                  <td>1,005</td>
                  <td>Nulla</td>
                  <td>quis</td>
                  <td>sem</td>
                  <td>at</td>
                </tr>
                <tr>
                  <td>1,006</td>
                  <td>nibh</td>
                  <td>elementum</td>
                  <td>imperdiet</td>
                  <td>Duis</td>
                </tr>
                <tr>
                  <td>1,007</td>
                  <td>sagittis</td>
                  <td>ipsum</td>
                  <td>Praesent</td>
                  <td>mauris</td>
                </tr>
                <tr>
                  <td>1,008</td>
                  <td>Fusce</td>
                  <td>nec</td>
                  <td>tellus</td>
                  <td>sed</td>
                </tr>
                <tr>
                  <td>1,009</td>
                  <td>augue</td>
                  <td>semper</td>
                  <td>porta</td>
                  <td>Mauris</td>
                </tr>
                <tr>
                  <td>1,010</td>
                  <td>massa</td>
                  <td>Vestibulum</td>
                  <td>lacinia</td>
                  <td>arcu</td>
                </tr>
                <tr>
                  <td>1,011</td>
                  <td>eget</td>
                  <td>nulla</td>
                  <td>Class</td>
                  <td>aptent</td>
                </tr>
                <tr>
                  <td>1,012</td>
                  <td>taciti</td>
                  <td>sociosqu</td>
                  <td>ad</td>
                  <td>litora</td>
                </tr>
                <tr>
                  <td>1,013</td>
                  <td>torquent</td>
                  <td>per</td>
                  <td>conubia</td>
                  <td>nostra</td>
                </tr>
                <tr>
                  <td>1,014</td>
                  <td>per</td>
                  <td>inceptos</td>
                  <td>himenaeos</td>
                  <td>Curabitur</td>
                </tr>
                <tr>
                  <td>1,015</td>
                  <td>sodales</td>
                  <td>ligula</td>
                  <td>in</td>
                  <td>libero</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div> -->

    
  

        <script>
          //Chcekc if user signed in
          fetchUserData ()
          function fetchUserData (){
      
              var token = localStorage.getItem('Authorization');
              if(token){
                console.log(token);
                  let options = {
                        headers: { 
                        },
                          method: "POST", 
                          body: JSON.stringify({
                          token:  token
                        })
                      };
                    
                      fetch('/api/1.0/admin/userProfile', options)
                        .then(response => {
                          let message = response.json();
                          console.log('fetching...');
                          return message;
                          })
                          .then(result => {
            
                            if (result.name==='notSignIn') {
                              console.log('API fetch success...')
                              console.log(result)
                              Swal.fire('Please sign in...');
                              setTimeout(function(){window.location.replace('/index.html')}, 3000);
                              } else {
                                window.location.replace('/admin/dashboard.html');
                                
                                }
                            });
                }else {
                  Swal.fire('Please sign in...');
                  setTimeout(function(){window.location.replace('/index.html')}, 3000);
                }
              } 

          //Date picker function
          $(document).ready(function(){
            var date_input=$('input[name="date"]'); //our date input has the name "date"
            var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
            var options={
              format: 'yyyy/mm/dd',
              container: container,
              todayHighlight: true,
              autoclose: true,
            };
            date_input.datepicker(options);
          })

                //Define process return multiple days efficiency
                function dashboard1() {

                  let x = [];
                  let y = [];
                  let w1 = [];
                  let w2 = [];
                  let w3 = [];
                  let values1 = [];
                  let value_of_date = [];
                  values1.push(['Actual Working Hour', 'Standard Working Hour', 'Actual Output', 'Standard Output', '<b>Efficiency %</b>']);
                  value_of_date.push('Date');

                  let startDate =  document.getElementById('startDate').value;
                  let endDate = document.getElementById('endDate').value;
                  let recordProcess = document.getElementById('recordProcess').value;

                  let options = {
                      headers: {
                          "Content-Type": "application/json"
                          },
                      method: "POST", 
                      body: JSON.stringify({
                          
                          startDate: startDate,
                          endDate: endDate,
                          recordProcess: recordProcess
                          
                          })
                      
                    };
                    
                  fetch('/api/1.0/admin/dashboard1', options)
                      .then(response => {
                          let message = response.json();
                          console.log('test');
                          return message;
                          })
                      .then(result => {
                          if (result) {
                              console.log("API fetch success...");
                              for (let i=0; i<result.length; i+=1){

                                x.push(result[i].date);
                                y.push(result[i].efficiency);

                                values1.push([result[i].actual_working_hour, result[i].standard_working_hour, result[i].actual_output, result[i].standard_output, result[i].efficiency]);
                                value_of_date.push(result[i].date);
                              }
                              
                              var data1 = [
                                          {
                                            x: x,
                                            y: y,
                                            type: 'bar'
                                          }
                                        ];
                                        var layout = {
                                              title: `${recordProcess}`,
                                              font:{
                                                size: 15,
                                                family: 'Raleway, sans-serif'
                                              },
                                              showlegend: false,
                                              xaxis: {
                                                tickangle: -45
                                              },
                                              yaxis: {
                                                zeroline: false,
                                                gridwidth: 2
                                              },
                                              bargap :0.05
                                            };

                              Plotly.newPlot('myDiv1', data1, layout);
                              
                              
                           

                              //chart of actual WH vs. standard WH
                              var data2 = [{
                                  type: 'table',
                                  
                                  header: {
                                    
                                    values: value_of_date,
                                    // [["<b>Date</b>"], ["<b>Q1</b>"],
                                    //     ["<b>Q2</b>"], ["<b>Q3</b>"], ["<b>Q4</b>"]],
                                    align: "center",
                                    height: 40,
                                    line: {width: 1, color: 'black'},
                                    fill: {color: "#337AB7"},
                                    font: {family: "Arial", size: 16, color: "white"}
                                  },
                                  cells: {
                                    values: values1,
                                    align: "center",
                                    height: 40,
                                    line: {color: "darkgrey", width: 1},
                                    font: {family: "Arial", size: 15, color: ["black"]}
                                  }
                                }]

                                Plotly.newPlot('myDiv1.1', data2);
                              
                              } else {
                                  alert(result.msg);
                                  }
                            });

                }
                
                //Define date return multiple process efficiency
                function dashboard2() {

                  let x = [];
                  let y = [];
                  let startDate =  document.getElementById('startDate2').value;

                  let options = {
                      headers: {
                          "Content-Type": "application/json"
                          },
                      method: "POST", 
                      body: JSON.stringify({
                          
                          startDate: startDate
                          
                          })
                      
                    };
                    
                  fetch('/api/1.0/admin/dashboard2', options)
                      .then(response => {
                          let message = response.json();
                          console.log('test');
                          return message;
                          })
                      .then(result => {
                          if (result) {
                              console.log("API fetch success...");
                              for (let i=0; i<result.length; i+=1){
                                x.push(result[i].process_refer);
                                y.push(result[i].efficiency);
                              }
                              var data = [
                                          {
                                            x: x,
                                            y: y,
                                            type: 'bar'
                                          }
                                        ];
                              var layout = {
                                    title: `${startDate}`,
                                    font:{
                                      size: 15,
                                      family: 'Raleway, sans-serif',
                                      
                                    },
                                    showlegend: false,
                                    xaxis: {
                                      tickangle: -45
                                    },
                                    yaxis: {
                                      zeroline: false,
                                      gridwidth: 2
                                    },
                                    bargap :0.05
                                  };            
                              Plotly.newPlot('myDiv2', data, layout);

                              //TEST time start
                              staticBigguyCost.update({
                              xAxis:{categories: x},
                          })
                          // update series
                          staticBigguyCost.series[0].update({ data: y }, false)
                          
                          // redraw plots
                          staticBigguyCost.redraw()
            //STOP                  
                              } else {
                                  alert(result.msg);
                                  }
                            });

                  }
          //TEST
          var options4BigguyCost = {
                                      chart: {
                                          type: 'column'
                                      },
                                      title: {
                                          text: ''
                                      },
                                      exporting: {
                                          enabled: true,
                                      },
                                      xAxis: {
                                          categories: [],
                                          crosshair: true
                                      },
                                      yAxis: {
                                          title: {
                                              text: '期貨留倉平均點數'
                                          }
                                      },
                                      tooltip: {
                                          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                                          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                                              '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
                                          footerFormat: '</table>',
                                          shared: true,
                                          useHTML: true
                                      },
                                      plotOptions: {
                                          column: {
                                              pointPadding: 0.2,
                                              borderWidth: 0
                                          }
                                      },
                                      credits: {
                                          enabled: false
                                      },
                                      series: [
                                          {
                                              name: '外資',
                                              data: [],
                                              color: "#23395B",
                                          },
                                          // {
                                          //     name: '自營商',
                                          //     data: [4,5,6],
                                          //     color: "#406E8E",
                                          // },
                                          // {
                                          //     name: '投信',
                                          //     data: [],
                                          //     color: "#8EA8C3",
                                          // },
                                      ]
                                  }

                                  var staticBigguyCost = Highcharts.chart('plot2', options4BigguyCost)
                                  //TEST OVER
                                  setInterval(dashboard2, 2000);
                                  setInterval(dashboard1, 2000);

                      
</script>

    </body>
</html>